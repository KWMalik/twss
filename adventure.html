<!DOCTYPE HTML>
<html>
<head>
<title>Adventure</title>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.21/themes/base/jquery-ui.css">
<script src="http://code.jquery.com/jquery-1.7.2.js"></script>
<script src="http://code.jquery.com/ui/1.8.21/jquery-ui.js"></script>

<style>
.ui-autocomplete {
	max-height: 60px;
	overflow-y: auto;
	/* prevent horizontal scrollbar */
	overflow-x: hidden;
	/* add padding to account for vertical scrollbar */
	padding-right: 20px;
}
/* IE 6 doesn't support max-height
 * we use height instead, but this forces the menu to always be this tall
 */
* html .ui-autocomplete {
	height: 100px;
}
</style>

<script>

	$.fn.teletype = function(opts){
	    var $this = this,
	        defaults = {
	            animDelay: 50,
				complete: function(){}
	        },
	        settings = $.extend(defaults, opts);
	        $this.html("");

	    $.each(settings.text, function(i, letter){
	        setTimeout(function(){
	            $this.html($this.html() + letter);
	        }, settings.animDelay * i);
	    });
		setTimeout(function(){ 
			settings.complete(this);
			}, settings.animDelay * settings.text.length);
	};

	$(function(){
	    $('#world').teletype({
	        animDelay: 35,
	        text: 'You see a wizard, a cat and a well.  There is a forest to the North and a cave to the East ...',
			complete: function(){$("#ui-widget").toggle('slow');}
	    });
	
	});
	
	function init(hashtable){
		$("#user-input").autocomplete({
			source: function( req, resp ) {
				    // if we have a complete word at the start, e.g. "Say" then we can 
					// move to second layer of auto-suggest
					var lookup = req.term.toLowerCase();
					// if there is a space then adjust lookup
					var words = lookup.split(" ");
					var list = hashtable;
					var prepend = "";
					if(words.length > 1)
					{
						for(i=0;i<words.length-1;i++)
						{
							list = list[words[i]];
							prepend += words[i] + " ";
						}
						lookup = words[i];
					}
				
                    // req.term is the contents of the input box, e.g. "Sa" or "Say t"
					// element is elements in the array

			        var filtered = $.grep( Object.keys(list), function(el) {
			            return el.toLowerCase().indexOf( lookup ) == 0;                                    
			        });
			        // prepend each of filtered
					filtered = $.each(filtered, function(index, value){
						filtered[index] = prepend + value;
					});	

			        resp( filtered );
					// could fill in user-input with most likely match? (in-place autocomplete?)
					// could be nice if when selecting element from list that space was added
					// and the next suggestions appeared
			    }
		});
		$('#submit').click(function() {
			//alert('submit clicked: '+ $("#user-input").val());
			// would be cool here to convert input box to pure text of user action - then
			// add new input boxes as necessary - could go to "The Hero Quoth:" Go North" "
			// need to hide autocomplete box if it is being displayed
			// may just disappear as side effect of changing input box to text?
			var userInput = $("#user-input").val();
			$('#ui-widget').replaceWith("<div style='color:#009900;padding:10px;'>"+userInput+'<br/></div>');
			
			if(userInput.toLowerCase() == "say to wizard drop cat in well")
			{			
			  	$('#result').teletype({
			        animDelay: 35,
			        text: 'You ask the wizard to drop the cat in the well.  He complies, and with a strangled meow the cat plummets down in the bucket.  Having purged the cat demons of fireflex 12 you become a knight of the external garter belt and live happily ever after ...'
			    });
			
			}else{
				$('#result').teletype({
			        animDelay: 35,
			        text: "Unfortunately nothing happens since the creator hasn't gotten around to implementing a response for that particular action yet ...",
					complete: function(){$('<div class="demo"> \
						<div id="ui-widget" class="ui-widget" style="display: none;"> \
						  <input id="user-input" name="tags" type="text" value="" size="100" /> \
						  <input id="submit" type="submit" value="Submit" /> \
						</div> \
		 \
						</div> \
						<div id="result"> \
 \
						</div>').insertAfter('#result');
						$('#result').replaceWith("<div>"+$('#result').text()+"</div>");
						$("#ui-widget").toggle('slow');
						init(hashtable);
					}
					// to make this new inputbox functional we'd have to re-associate 
					// actions with it
					
			    });    
			}
		});
		$("#user-input").keyup(function(event){
		    if(event.keyCode == 13){
		        $("#submit").click();
		    }
		    if(event.keyCode == 9){
		        // want to select first item in list ...
		    }
		});
	};
	
	$(function() {
		var placeholder = {};
		var hashtable = {
			"go": {"north":null, "east":null},
			"drop": { // should this be "Drop" - or extract this and have a number of verbs work? look up in thesaurus?
				"wizard": {
					"in": {"well":null, "cat":null} 
				},
				"cat": {
					"in": {"well":null, "wizard":null}
				} 
			},
			"say": {
				"to": {
					"wizard": placeholder, 
					"cat": placeholder
					}
				}
			};
		// simply unpdating placeholder doesn't work because of closure
		placeholder = hashtable;
		// at the moment the following is required for recursive hashtable structure
		hashtable['say']['to']['wizard'] = hashtable;
		hashtable['say']['to']['cat'] = hashtable;
		init(hashtable);
	});
	
	</script>

</head>
<body>
	

<div id="world">
	
</div>

<div class="demo">
<div id="ui-widget" class="ui-widget" style="display: none;">
  <input id="user-input" name="tags" type="text" value="" size="100" />
  <input id="submit" type="submit" value="Submit" />
</div>

</div>
<div id="result">
	
</div>

<br />
<br />
<hr />
<div>Above is my attempt to implement the sketch below</div>
<img src="images/interactive-fiction-dropdowns.jpg">


</body>
</html>



